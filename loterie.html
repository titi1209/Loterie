<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Loterie — Probabilités pondérées</title>
  <style>
    :root {
      --radius: 14px;
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      background: radial-gradient(1200px 800px at 20% -10%, #f8fbff 0%, #eef4ff 30%, #e9f5ff 60%, #f7fbff 100%);
      color: #0f172a;
      display: grid;
      place-items: center;
      padding: 24px;
    }
    .card {
      width: min(680px, 100%);
      background: #fff;
      border: 1px solid #e5e7eb;
      border-radius: var(--radius);
      box-shadow: 0 20px 35px rgba(2, 6, 23, 0.06);
      overflow: hidden;
    }
    header {
      padding: 18px 20px;
      background: linear-gradient(135deg, #2563eb, #4f46e5);
      color: #fff;
    }
    header h1 {
      font-size: clamp(18px, 2.6vw, 22px);
      margin: 0;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    header h1 span {
      display: inline-block;
      padding: 2px 8px;
      border: 1px solid rgba(255,255,255,.35);
      border-radius: 999px;
      font-weight: 500;
      font-size: .9em;
      backdrop-filter: blur(4px);
    }
    main { padding: 22px; display: grid; gap: 18px; }
    .grid { display: grid; gap: 16px; grid-template-columns: 1fr; }
    @media (min-width: 720px) {
      .grid { grid-template-columns: 1fr 1fr; }
    }
    .panel {
      border: 1px solid #e5e7eb;
      border-radius: 12px;
      padding: 16px;
      background: #fafafa;
    }
    .panel h2 {
      margin: 0 0 10px;
      font-size: 16px;
      color: #111827;
    }
    .outcomes { display: grid; gap: 8px; }
    .outcome {
      display: grid;
      grid-template-columns: 1fr auto auto;
      gap: 10px;
      align-items: center;
      padding: 10px 12px;
      background: #fff;
      border: 1px solid #e5e7eb;
      border-radius: 10px;
    }
    .outcome b { font-size: 16px; }
    .outcome .p { font-variant-numeric: tabular-nums; }
    .result {
      display: grid;
      place-items: center;
      min-height: 120px;
      background: conic-gradient(from 180deg at 50% 50%, #f8fafc, #eef2ff);
      border: 1px dashed #cbd5e1;
      border-radius: 12px;
      font-size: clamp(22px, 4.5vw, 34px);
      font-weight: 700;
    }
    .controls { display: flex; flex-wrap: wrap; gap: 10px; }
    button {
      appearance: none;
      border: 0;
      background: #111827;
      color: #fff;
      padding: 12px 16px;
      border-radius: 10px;
      cursor: pointer;
      transition: transform .02s ease, box-shadow .2s ease, background .2s ease;
      box-shadow: 0 8px 18px rgba(17,24,39,.14);
      font-weight: 600;
    }
    button.secondary { background: #334155; }
    button.ghost { background: transparent; color: #111827; border: 1px solid #e5e7eb; box-shadow: none; }
    button:disabled { opacity: .6; cursor: not-allowed; box-shadow: none; }
    .stats { display: grid; grid-template-columns: repeat(3, minmax(0,1fr)); gap: 10px; }
    .stat {
      background: #fff;
      border: 1px solid #e5e7eb;
      border-radius: 10px;
      padding: 10px 12px;
    }
    .stat .label { font-size: 12px; color: #6b7280; }
    .stat .value { font-size: 18px; font-weight: 700; }
    .note { color: #6b7280; font-size: 13px; }
    footer {
      border-top: 1px solid #e5e7eb;
      padding: 14px 20px;
      font-size: 12px;
      color: #6b7280;
      background: #fff;
    }
    code { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace; background: #f3f4f6; padding: 1px 6px; border-radius: 6px; }
    .blink { animation: pop .35s ease; }
    @keyframes pop { 50% { transform: scale(1.06); } }
  </style>
</head>
<body>
  <div class="card" role="region" aria-labelledby="title">
    <header>
      <h1 id="title">Loterie <span>pondérée</span></h1>
    </header>
    <main>
      <div class="grid">
        <section class="panel" aria-labelledby="outcomes-title">
          <h2 id="outcomes-title">Table des gains & probabilités</h2>
          <div class="outcomes" id="outcomeList" aria-live="polite"></div>
          <p class="note" id="ev">Espérance (calculée): …</p>
          <p class="note" id="sumCheck"></p>
        </section>

        <section class="panel" aria-labelledby="draw-title">
          <h2 id="draw-title">Tirage</h2>
          <div class="result" id="result" aria-live="assertive" aria-atomic="true">Cliquez sur « Tirer »</div>
          <div class="controls">
            <button id="drawBtn">🎲 Tirer</button>
            <button id="draw100Btn" class="secondary">💯 Tirer ×100</button>
            <button id="resetBtn" class="ghost">↺ Réinitialiser</button>
          </div>
          <div class="stats" aria-label="Statistiques">
            <div class="stat">
              <div class="label">Tirages</div>
              <div class="value" id="plays">0</div>
            </div>
            <div class="stat">
              <div class="label">Total gagné</div>
              <div class="value"><span id="total">0</span> €</div>
            </div>
            <div class="stat">
              <div class="label">Gain moyen</div>
              <div class="value"><span id="avg">0</span> €</div>
            </div>
          </div>
        </section>
      </div>
    </main>
    <footer>
      Configuré pour : 60 %→0 €, 12 %→2 €, 15 %→5 €, 8 %→20 €, 4 %→50 €, 1 %→100 €.  
      Vous pouvez adapter la configuration dans le code (<code>config</code>).
    </footer>
  </div>

  <script>
    const config = [
      { amount: 0,   p: 60 },
      { amount: 2,   p: 12 },
      { amount: 5,   p: 15 },
      { amount: 20,  p: 8  },
      { amount: 50,  p: 4  },
      { amount: 100, p: 1  },
    ];
    const € = n => n.toLocaleString("fr-FR", { maximumFractionDigits: 2 });
    const outcomeList = document.getElementById("outcomeList");
    const sumCheck = document.getElementById("sumCheck");
    const evEl = document.getElementById("ev");
    (function initTable() {
      outcomeList.innerHTML = "";
      let totalP = 0; let ev = 0;
      config.forEach(item => {
        totalP += item.p;
        ev += (item.amount * (item.p / 100));
        const row = document.createElement("div");
        row.className = "outcome";
        row.innerHTML = `<div><b>${€(item.amount)} €</b></div>
          <div class="p">${item.p.toFixed(0)} %</div>
          <progress max="100" value="${item.p}" style="width:120px"></progress>`;
        outcomeList.appendChild(row);
      });
      evEl.textContent = `Espérance (calculée) : ${€(ev)} € par tirage`;
      const ok = Math.abs(totalP - 100) < 1e-9;
      sumCheck.textContent = ok
        ? "La somme des probabilités = 100 % ✅"
        : `⚠️ Somme des probabilités = ${totalP} % (doit faire 100 %)`;
      sumCheck.style.color = ok ? "#16a34a" : "#b91c1c";
    })();
    const bands = (() => {
      let start = 0;
      return config.map(({amount, p}) => {
        const end = start + p;
        const band = { start, end, amount };
        start = end;
        return band;
      });
    })();
    function drawOnce() {
      const r = Math.random() * 100;
      const hit = bands.find(b => r >= b.start && r < b.end) || bands.at(-1);
      return hit.amount;
    }
    const resultEl = document.getElementById("result");
    const playsEl  = document.getElementById("plays");
    const totalEl  = document.getElementById("total");
    const avgEl    = document.getElementById("avg");
    const btn      = document.getElementById("drawBtn");
    const btn100   = document.getElementById("draw100Btn");
    const resetBtn = document.getElementById("resetBtn");
    let plays = 0, total = 0;
    function updateStats() {
      playsEl.textContent = plays.toString();
      totalEl.textContent = €(total);
      avgEl.textContent   = plays ? €(total / plays) : "0";
    }
    function animateResult(text) {
      resultEl.textContent = text;
      resultEl.classList.remove("blink");
      void resultEl.offsetWidth;
      resultEl.classList.add("blink");
    }
    async function safeDisable(actions, fn) {
      try { actions.forEach(a => a.disabled = true); await fn(); }
      finally { actions.forEach(a => a.disabled = false); }
    }
    btn.addEventListener("click", () => {
      safeDisable([btn, btn100], async () => {
        const prize = drawOnce();
        plays += 1; total += prize;
        animateResult(prize ? `🎉 +${€(prize)} €` : "🙃 0 €");
        updateStats();
      });
    });
    btn100.addEventListener("click", () => {
      safeDisable([btn, btn100], async () => {
        let localTotal = 0; let n = 100;
        while (n--) { localTotal += drawOnce(); }
        plays += 100; total += localTotal;
        animateResult(`Tirages ×100 → +${€(localTotal)} €`);
        updateStats();
      });
    });
    resetBtn.addEventListener("click", () => {
      plays = 0; total = 0;
      animateResult("Réinitialisé. Cliquez sur « Tirer »");
      updateStats();
    });
    updateStats();
  </script>
</body>
</html>